{% extends "bi/base.html" %}
{% load static %}

{% block titulo %} Inicio {% endblock %}

{% block statics %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock %}

{% block classBody %}
{% endblock %}

{% block classDiv %}
class="main-content"
{% endblock %}

{% block contenido %}
<!-- Main Dashboard -->
<main class="container py-4">
    <!-- KPIs -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ventas (Mes)</h6>
                    <h3 class="text-success fw-bold">${{ ultimo_Informe.resumen_ventas }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Gastos (Mes)</h6>
                    <h3 class="text-danger fw-bold">${{ ultimo_Informe.resumen_gastos }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Balance</h6>
                    <h3 class="text-primary fw-bold">${{ balance }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card text-center shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Remuneración</h6>
                    <h3 class="text-purple fw-bold">${{ ultimo_Informe.resumen_remuneraciones }}</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficas -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex align-items-center justify-content-center text-muted">
                    <canvas id="ventasGastosChart"></canvas>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm h-100">
                <div class="card-body d-flex align-items-center justify-content-center text-muted">
                    <canvas id="gastosCategoriaChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- IA y Reportes -->
    <div class="row g-4 mb-4">
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">Asistente IA</h5>
                    <textarea class="form-control mb-3" rows="3"
                        placeholder="Ej: ¿Qué tendencia se espera en ventas para el próximo trimestre?"></textarea>
                    <button class="btn btn-primary">Consultar</button>
                    <div class="mt-3 text-muted small">[Aquí aparecerá la respuesta de la IA]</div>
                </div>
            </div>
        </div>
        {% include "bi/body/components/rol/adm.html" %}
    </div>

    <!-- Alertas -->
    {% include "bi/body/components/alertas.html" %}

</main>

<script>
    // Gráfico 1: Ventas vs Gastos (Ejemplo de referencia)
    const ctx1 = document.getElementById('ventasGastosChart').getContext('2d');
    const ventasGastosChart = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
            datasets: [
                {
                    label: 'Ventas',
                    data: [120000, 130000, 140000, 150000, 160000, 140000, 130000, 140000, 150000, 160000, 170000, 175000],
                    backgroundColor: '#4a90e2'
                },
                {
                    label: 'Gastos',
                    data: [2900000, 3000000, 3100000, 3050000, 3000000, 2950000, 3000000, 3050000, 3000000, 3100000, 3050000, 3053576],
                    backgroundColor: '#e94e4e'
                }
            ]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: true, text: 'Ventas vs Gastos Mensual' }
            }
        }
    });

    // Gráfico 2: Gastos por Categoría (Ejemplo de referencia)
    const ctx2 = document.getElementById('gastosCategoriaChart').getContext('2d');

    const gastosCategoriaChart = new Chart(ctx2, {
        type: 'pie',
        data: {
            labels: ['EPP', 'M', 'H', 'GG'],
            datasets: [{
                label: 'Gastos por Categoría',
                data: [4000000, 7500000, 3000000, 14056743],  // suma = 28.056.743
                backgroundColor: ['#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'right' },
                title: { display: true, text: 'Gastos por Categoría' }
            }
        }
    });


</script>
{% endblock %}